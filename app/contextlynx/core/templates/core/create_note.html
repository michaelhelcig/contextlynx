{% extends 'core/base.html' %}

{% block content %}
<div class="fixed bottom-0 left-0 right-0 flex items-end justify-center p-4">
    <form id="note-form" method="POST" action="{% url 'new_note' %}" class="w-full max-w-3xl flex items-center">
        {% csrf_token %}
        <!-- Chat bubble (textarea) -->
        <textarea id="data_raw" name="data_raw" rows="25" class="flex-1 px-4 py-3 border rounded-lg shadow-lg resize-none"></textarea>

        <!-- Round button with arrow up next to the chat bubble -->
        <button id="submit-button" type="submit" class="bg-blue-600 text-white w-12 h-12 rounded-full flex items-center justify-center hover:bg-blue-700 shadow-lg ml-3">
            <span id="button-content">&#x2191;</span>
        </button>
    </form>
</div>

{% if messages %}
    <div class="mt-4 text-center">
        {% for message in messages %}
            <p class="text-{{ message.tags }}-500">{{ message }}</p>
        {% endfor %}
    </div>
{% endif %}

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('note-form');
    const textarea = document.getElementById('data_raw');
    const button = document.getElementById('submit-button');
    const buttonContent = document.getElementById('button-content');

    function showLoadingSpinner() {
        buttonContent.innerHTML = '<div class="loader"></div>';
        button.disabled = true;
    }

    form.addEventListener('submit', function(e) {
        e.preventDefault();
        showLoadingSpinner();
        this.submit();
    });

    textarea.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            showLoadingSpinner();
            form.submit();
        }
    });
});
</script>

<style>
/* Loader styling */
.loader {
    border: 4px solid rgba(0, 0, 0, 0.1); /* Light grey */
    border-radius: 50%;
    border-top: 4px solid #fff; /* White */
    width: 20px;
    height: 20px;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Additional styling for textarea */
textarea {
    min-height: 300px; /* Ensure it's taller */
    min-width: 500px; /* Ensure it's wider */
    resize: none; /* Disable resizing if desired */
}
</style>

{% endblock %}